## 在一个HTTPS连接的网站里，输入账号密码点击登录后，到服务器返回这个请求前，中间经历了什么

![HTTPS加密流程](http://7xs5iw.com1.z0.glb.clouddn.com/1721232-75f07ac2d2897ff2.png)
1. 客户端会打包一个请求，包括url，端口啊，你的账号密码等等。账号密码登陆应该用的是Post方式，所以相关的用户信息会被加载到body里面。这个请求应该包含三个方面：网络地址，协议，资源路径。注意，这里是HTTPS，就是HTTP + SSL / TLS，在HTTP上又加了一层处理加密信息的模块（相当于是个锁）。

2. 一般会先请求DNS服务器。DNS服务器负责将你的网络地址解析成IP地址，这个IP地址对应网上一台机器。这其中可能发生Hosts Hijack和ISP failure的问题。

3. 协议是获取资源的方式HTTP，FTP，UDP，不同协议有不同的格式，有些是process-to-process的，有些是host-to-host的。

4. 客户端会和服务器的端口之间建立一个socket连接，socket一般都是以file descriptor的方式解析请求。

5. 服务器端接收到请求。服务器端会有一套数字证书（相当于是个钥匙），这个证书会先返回给客户端。客户端会解析证书，相当于用钥匙（证书）把锁（内容）锁上（生成私匙），接着再传送加密信息。

6. 服务器端接收到加密信息（私匙）之后，会进行解密，并把要返回的数据进行对称加密返回到客户端。假如路径不对，会出现404的错误。

7. 一般访问服务器之前可能会访问一下proxy。这玩意是个代理，有时候当防火墙用，有时候当cache使。如果后台是reverse-proxy结构，那么实际上有多个web服务器藏在proxy之后按需处理请求，而你访问的永远是proxy，这样可以解决过载问题。

8. 有时候访问完web服务器后还要访问一下file服务器，主要是请求数据库里的一些信息。

9. 服务器将相应打包，直接或通过proxy（大多数时候）返回给客户端。客户端会用刚刚生成的私匙进行解密，将内容显示在浏览器上。

HTTPS加密过程详解请去https原理：[证书传递、验证和数据加密、解密过程解析](http://blog.csdn.net/clh604/article/details/22179907)

